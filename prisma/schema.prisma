// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String    @id @default(cuid())
  email                 String    @unique
  name                  String?
  stripeConnectAccountId String?  @unique
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  userLimits            UserLimits[]

  @@map("users")
}

model Gift {
  id                    String    @id @default(cuid())
  amount                Int
  currency              String    @default("eur")
  message               String?
  authenticationCode    String    @unique
  isClaimed             Boolean   @default(false)
  claimedAt             DateTime?
  stripePaymentIntentId String?   @unique
  stripeTransferId      String?
  animationPreset       String    @default("confettiRealistic")
  stripeConnectAccountId String?  // Stripe Connect account ID for recipient
  platformFeeAmount     Int?      // Platform fee amount in cents
  applicationFeeAmount  Int?      // Stripe application fee amount in cents
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("gifts")
}

model UserLimits {
  id                    String   @id @default(cuid())
  stripeConnectAccountId String
  currentAmount         Int      @default(0)
  currentGiftCount      Int      @default(0)
  month                 Int
  year                  Int
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  user                  User     @relation(fields: [stripeConnectAccountId], references: [stripeConnectAccountId], onDelete: Cascade)

  @@unique([stripeConnectAccountId, month, year])
  @@map("user_limits")
}